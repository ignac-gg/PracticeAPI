# PracticeAPI

This API was built as a refresher project for practicing API development and it
also served as a little challenge. It provides a simple interface for uploading
data from CSV files and querying a local SQL Server database.

The API exposes five endpoints:

Three endpoints are used to upload CSV files and populate a local SQL Server
database with the following tables:

- Departments
- Employees
- Jobs

The tables are created automatically if they don't already exist.

Two endpoints allow querying the database using raw SQL via the SQLModule.

The project does not include input validation or authentication
(mainly due to its limited time), but it was a fun experience learning FastAPI
and working with databases from an API for the first time.

## Endpoints

As mentioned there are 5 endpoints in total, the first 3 of them deal with loading
data using csv files.

### POST /upload_departments/

Uploads a CSV file containing department data and inserts it into the Departments
table in the local SQL Server database.

Example CSV Format:

```
1,Supply Chain
2,Maintenance
3,Staff
```

It expects the CSV columns to match the expected schema exactly.

### POST /upload_hired/

Uploads a CSV file containing hired employees data and inserts it into the Employees
table in the local SQL Server database.

Example CSV Format:

```
4535,Marcelo Gonzalez,2021-07-27T16:02:08Z,1,2
4572,Lidia Mendez,2021-07-27T19:04:09Z,1,2
```

It expects the CSV columns to match the expected schema exactly.

### POST /upload_jobs/

Uploads a CSV file containing job data and inserts it into the Jobs
table in the local SQL Server database.

Example CSV Format:

```
1, Recruiter
2, Manager
3, Analyst
```

It expects the CSV columns to match the expected schema exactly.

### GET /hired/quarterly/

Returns a list of the number of employees hired per quarter (Q1â€“Q4) in the
year 2021, grouped by department and job.

The data is generated by executing a raw SQL query using SQLModule directly
on the local SQL Server database.

#### GET /hired/quarterly/html/

Queries the DB with the same query used in `/hired/quarterly/` but returns an
HTML to be rendered as a table.

### GET /hired/above-average-2021/

Returns a list of departments that hired more people than the average number of
hires per department in the year 2021.

The data is generated by executing a raw SQL query using SQLModule directly
on the local SQL Server database.

#### GET /hired/above-average-html/

Queries the DB with the same query used in `/hired/above-average-2021/` but
returns an HTML to be rendered as a table.

## Instructions

Python 3 is needed, the main libraries are FastAPI + SQLModel, for connecting
to the DB pyodbc library is needed for the driver.

```
pip install -r requirements.txt
```

To handle all related dependencies.

### Local DB (SQL Server)

A local SQL Server database is required, once created, replace the value of the
`DB_NAME` variable located in _db/db.py_ with the name of the DB.

Tables are attempted to be created when the application is run, given that
currently there are no validations this could throw an error.

### Order Considerations

The first step is to create the local DB and replace the previously mentioned
variable value to the name of the new DB.

It is necessary to run the 3 endpoints that upload csv files to the database
for the remaining 2 endpoints to work properly.

## Considerations and Limitations

### Endpoint Execution Order Matters

The endpoints related to uploading data must be executed prior to the other endpoints:

- /upload_departments/
- /upload_jobs/
- /upload_employees/

### No Input Validation

The API does not validate the CSV files. Uploading files with: Incorrect columns
or unsupported formats (e.g. Excel, TXT) most likely will cause errors.

### No Error Handling

There is a single function that handles errors, aside from that one, errors are
not handled in any way.
